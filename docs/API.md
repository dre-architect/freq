# FREQ AI - API Documentation

## Overview

The FREQ AI system exposes a RESTful API for controlling the autonomous barge drafting system and retrieving system state.

## Base URL

```
http://localhost:5000/api/v1
```

## Authentication

Currently, the system does not require authentication. In production, implement OAuth2 or API key authentication.

## Endpoints

### Health Check

Check if the system is operational.

**Endpoint:** `GET /health`

**Response:**
```json
{
  "status": "healthy",
  "version": "4.0.0",
  "timestamp": "2024-02-13T12:00:00Z"
}
```

### Get System State

Retrieve current system state.

**Endpoint:** `GET /state`

**Response:**
```json
{
  "status": "ready",
  "start_time": "2024-02-13T10:00:00Z",
  "cycles_completed": 5
}
```

**Status Values:**
- `initialized` - System just started
- `ready` - Ready to process
- `processing` - Currently processing a cycle
- `error` - Error state
- `shutdown` - System shutting down

### Start Drafting Cycle

Initiate a new autonomous drafting cycle.

**Endpoint:** `POST /cycle/start`

**Request Body:**
```json
{
  "rgb": [[/* RGB image data */]],
  "depth": [[/* Depth map data */]],
  "camera_intrinsics": {
    "fx": 525.0,
    "fy": 525.0,
    "cx": 319.5,
    "cy": 239.5
  }
}
```

**Response (Success):**
```json
{
  "success": true,
  "cycle_id": 6,
  "geometry": {
    "draft": 2.5,
    "trim": 0.2,
    "heel": -0.1,
    "dimensions": {
      "length": 50.0,
      "width": 12.0,
      "depth": 3.5
    }
  },
  "gcode": "; FREQ AI G-Code\nG21\nG90\n...",
  "timestamp": "2024-02-13T12:05:00Z"
}
```

**Response (Error):**
```json
{
  "success": false,
  "error": "Insufficient points: 500 < 1000",
  "timestamp": "2024-02-13T12:05:00Z"
}
```

### Download G-Code

Download generated G-Code for a specific cycle.

**Endpoint:** `GET /cycle/:cycle_id/gcode`

**Response:**
```
; FREQ AI - Autonomous Barge Drafting G-Code
; Generated by G-Code Translator Agent v4.0
G21  ; Set units to millimeters
G90  ; Absolute positioning
...
```

## WebSocket Events

Connect to WebSocket for real-time updates.

**Endpoint:** `ws://localhost:5000/ws`

### Events Sent to Client

#### Point Cloud Update
```json
{
  "type": "point_cloud_update",
  "data": {
    "num_points": 15000,
    "frame_shape": [480, 640]
  },
  "timestamp": "2024-02-13T12:00:00Z"
}
```

#### State Update
```json
{
  "type": "state_update",
  "data": {
    "status": "processing",
    "cycles_completed": 5
  },
  "timestamp": "2024-02-13T12:00:00Z"
}
```

#### Progress Update
```json
{
  "type": "progress_update",
  "cycle_id": 6,
  "progress": 45.5,
  "timestamp": "2024-02-13T12:00:00Z"
}
```

#### Alert
```json
{
  "type": "alert",
  "alert_type": "warning",
  "message": "Draft measurement approaching maximum limit",
  "timestamp": "2024-02-13T12:00:00Z"
}
```

**Alert Types:**
- `info` - Informational message
- `warning` - Warning condition
- `error` - Error condition

## Error Codes

| Code | Description |
|------|-------------|
| 200 | Success |
| 400 | Bad Request - Invalid input data |
| 422 | Unprocessable Entity - Validation failed |
| 500 | Internal Server Error |
| 503 | Service Unavailable - System not ready |

## Rate Limiting

No rate limiting is currently implemented. In production, implement rate limiting based on:
- IP address
- API key
- User account

## Data Formats

### RGB-D Data Format

RGB images should be provided as:
- Format: NumPy array
- Shape: (height, width, 3)
- Data type: uint8
- Color space: RGB

Depth maps should be provided as:
- Format: NumPy array
- Shape: (height, width)
- Data type: float32
- Units: meters

### Camera Intrinsics

Camera calibration parameters:
- `fx`, `fy`: Focal lengths in pixels
- `cx`, `cy`: Principal point coordinates

## Example Usage

### Python

```python
import requests
import numpy as np

# Health check
response = requests.get('http://localhost:5000/api/v1/health')
print(response.json())

# Start drafting cycle
rgb_data = np.zeros((480, 640, 3), dtype=np.uint8)
depth_data = np.zeros((480, 640), dtype=np.float32)

payload = {
    'rgb': rgb_data.tolist(),
    'depth': depth_data.tolist(),
    'camera_intrinsics': {
        'fx': 525.0,
        'fy': 525.0,
        'cx': 319.5,
        'cy': 239.5
    }
}

response = requests.post(
    'http://localhost:5000/api/v1/cycle/start',
    json=payload
)
print(response.json())
```

### JavaScript

```javascript
// Health check
fetch('http://localhost:5000/api/v1/health')
  .then(response => response.json())
  .then(data => console.log(data));

// WebSocket connection
const ws = new WebSocket('ws://localhost:5000/ws');

ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  console.log('Received:', message);
};
```

## Versioning

The API uses URL versioning (e.g., `/api/v1/`). Breaking changes will result in a new version number.

Current version: **v1**
